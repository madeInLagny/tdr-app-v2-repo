<script>
  // Only load the CDN script if not running on localhost or file protocol
  var ccScript = null;
  var shouldLoadGDPR = null;

  if (
    location.hostname !== "localhost" &&
    location.hostname !== "127.0.0.1" &&
    location.protocol !== "file:"
  ) {
    ccScript = document.createElement('script');
    ccScript.defer = true;
    ccScript.src = "https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@3.1.0/dist/cookieconsent.umd.js";
    
    // Load config after ccScript is resolved
    ccScript.onload = function() {
      if (shouldLoadGDPR !== null) {
        loadCDN(shouldLoadGDPR);
      }
    };
    
    document.head.appendChild(ccScript);
  }
</script>

<script>
  // Function to load the CDN script
  function loadCDN(GDPR) {
    var script = document.createElement('script');
    script.src = GDPR ? "./js/cookieConsent/gdpr-config.js" : "./js/cookieConsent/row-config.js";
    script.async = true;
    document.body.appendChild(script);
    script.onerror = function () {
      console.error('Error loading CDN script.');
    };
  }

  // Function to check if the user is in the EU
  function checkEULocation() {
    fetch('https://ipinfo.io/json')
      .then(response => response.json())
      .then(data => {
        // Check if the country is in the EU
        var euCountries = ['GB', 'AT', 'BE', 'BG', 'CY', 'CZ', 'DE', 'DK', 'EE', 'ES', 'FI', 'FR', 'GR', 'HR', 'HU', 'IE', 'IT', 'LT', 'LU', 'LV', 'MT', 'NL', 'PL', 'PT', 'RO', 'SE', 'SI', 'SK'];
        if (euCountries.includes(data.country)) {
          shouldLoadGDPR = true;
        } else {
          shouldLoadGDPR = false;
        }
        
        // If ccScript is not loaded yet, wait for it
        if (ccScript && ccScript.readyState === 'loading') {
          // ccScript will trigger loadCDN on load
        } else {
          // ccScript was not created (localhost) or already loaded
          loadCDN(shouldLoadGDPR);
        }
      })
      .catch(error => {
        console.error('Error fetching IP information:', error);
        loadCDN(false); // Default to non-GDPR config on error
      });
  }

  // Check the user's location on page load
  checkEULocation();
</script>